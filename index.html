<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¸è¿å¤§è½¬ç›˜ - ç§¯åˆ†ç™½å«–æ— é—¨æ§›</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;}
        body{width:100vw;height:100vh;/* æ›¿æ¢ä¸ºä½ çš„é»‘é‡‘å›¾ç‰‡é“¾æ¥ */background: url("baipiao_2.jpg") no-repeat center center; background-size: cover;display:flex;flex-direction:column;justify-content:center;align-items:center;overflow:hidden;font-family:"Microsoft Yahei", "PingFang SC", sans-serif;}
        .activity-title {
            font-size: 24px;
            color: #e63946;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }
        .activity-subtitle {
            font-size: 16px;
            color: #457b9d;
            margin-bottom: 15px;
            text-align: center;
        }
        .input-wrapper {
            width: 320px;
            text-align: center;
            margin-bottom: 20px;
        }
        .remain-times {
            color: #333;
            font-size: 18px;
            margin-bottom: 15px;
            font-weight: 500;
        }
        .account-group {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .account-input {
            padding: 10px 15px;
            width: 180px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
            outline: none;
            transition: border-color 0.3s;
        }
        .account-input:focus {
            border-color: #e63946;
        }
        .submit-btn {
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 4px;
            background: #e63946;
            color: #fff;
            cursor: pointer;
            transition: background 0.3s;
        }
        .submit-btn:hover {
            background: #c1121f;
        }
        .lottery-container {
            position: relative;
            width: 400px;
            height: 400px;
            margin: 10px auto;
        }
        .lottery-wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            border: 5px solid #e63946;
            background: #fff;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .wheel-item {
            position: absolute;
            width: 50%;
            height: 50%;
            left: 50%;
            top: 0;
            transform-origin: left bottom;
            clip-path: polygon(0 0, 100% 0, 100% 100%);
            display: flex;
            justify-content: center;
            align-items:flex-start;
            padding-top: 40px;
            color: #fff;
            font-size: 17px;
            font-weight: 500;
        }
        .wheel-item:nth-child(1){background: #e63946;}
        .wheel-item:nth-child(2){background: #2a9d8f;}
        .wheel-item:nth-child(3){background: #f4a261;}
        .wheel-item:nth-child(4){background: #264653;}
        .wheel-item:nth-child(5){background: #e9c46a;}
        .wheel-item:nth-child(6){background: #f1faee; color: #333;}
        .wheel-item:nth-child(7){background: #8d99ae;}
        .wheel-item span {
            display: inline-block;
            transform: rotate(0deg) !important;
            white-space: nowrap;
            margin-top: 10px;
        }
        .lottery-pointer {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            width: 35px;
            height: 50px;
            background: #e63946;
            clip-path: polygon(50% 0, 0 100%, 100% 100%);
            z-index: 10;
            box-shadow: 0 2px 6px rgba(230,57,70,0.5);
        }
        .lottery-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: #e63946;
            border: 4px solid #fff;
            font-size: 18px;
            font-weight: bold;
            color: #fff;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(230,57,70,0.3);
            transition: background 0.3s;
            display: none;
            z-index: 15;
        }
        .lottery-btn:disabled {
            background: #ccc;
            box-shadow: none;
            cursor: not-allowed;
        }
        .modal{
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.5);
            z-index: 100;
            display: none;
            justify-content: center;
            align-items: center;
        }
        .modal-box{
            width: 320px;
            padding: 30px 20px;
            border-radius: 8px;
            background: #fff;
            text-align: center;
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
            position: relative;
            overflow: visible;
        }
        .modal-title {
            color: #e63946;
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .emoji {
            font-size: 40px;
            margin-bottom: 15px;
        }
        .modal-content {
            font-size: 18px;
            margin-bottom: 25px;
            color: #555;
        }
        .rule-tip {
            font-size: 14px;
            color: #888;
            margin-top: 10px;
            line-height: 1.5;
        }
        .close-btn {
            width: 120px;
            height: 40px;
            border: none;
            border-radius: 4px;
            background: #e63946;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
        }
        .confetti {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 200;
            display: none;
        }
        .confetti-piece {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #e63946;
            border-radius: 50%;
            opacity: 0.9;
            animation: confetti-out 2s ease-out forwards;
        }
        @keyframes confetti-out {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            100% { transform: translate(calc(-50% + var(--x)), calc(-50% + var(--y))) scale(1); opacity: 0; }
        }
        .fireworks {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 200;
            display: none;
        }
        .firework {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: firework 2s ease-out forwards;
        }
        .firework-piece {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            animation: firework-piece 1.5s ease-out forwards;
        }
        @keyframes firework {
            0% { transform: scale(0); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.8; }
            100% { transform: scale(2); opacity: 0; }
        }
        @keyframes firework-piece {
            0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            100% { transform: translate(calc(-50% + var(--x)), calc(-50% + var(--y))) scale(0.3); opacity: 0; }
        }
        .audio-container {
            display: none;
        }
        .footer-tip {
            font-size: 14px;
            color: #666;
            margin-top: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="activity-title">ç§¯åˆ†ç™½å«–æ— é—¨æ§› Â· å¹¸è¿å¤§è½¬ç›˜</div>
    <div class="activity-subtitle">ç­¾åˆ°é¢†ç§¯åˆ† | å¤šç©ç¿»å€ | å¥½ç¤¼éšå¿ƒå…‘</div>
    
    <div class="input-wrapper">
        <div class="remain-times" id="remainText">è¯·è¾“å…¥è´¦å·å¹¶æäº¤</div>
        <div class="account-group">
            <input type="text" class="account-input" id="accInput" placeholder="è¾“å…¥æŠ½å¥–è´¦å·">
            <button class="submit-btn" id="submitBtn">æäº¤è´¦å·</button>
        </div>
    </div>
    
    <div class="lottery-container">
        <div class="lottery-wheel" id="wheel">
            <div class="wheel-item" style="transform:rotate(0deg)"><span>å·®ä¸€ç‚¹ç‚¹</span></div>
            <div class="wheel-item" style="transform:rotate(51.43deg)"><span>1888è¶…çº§ç¦åˆ©ï¼ˆé™3ä»½ï¼‰</span></div>
            <div class="wheel-item" style="transform:rotate(102.86deg)"><span>888ä¸“å±ç¦åˆ©ï¼ˆé™5ä»½ï¼‰</span></div>
            <div class="wheel-item" style="transform:rotate(154.29deg)"><span>è½¬è¿é‡‘Ã—1ï¼ˆé™5ä»½ï¼‰</span></div>
            <div class="wheel-item" style="transform:rotate(205.71deg)"><span>ä¸“å±çº¢åŒ…388ï¼ˆé™8ä»½ï¼‰</span></div>
            <div class="wheel-item" style="transform:rotate(257.14deg)"><span>ä¸“å±çº¢åŒ…288ï¼ˆé™18ä»½ï¼‰</span></div>
            <div class="wheel-item" style="transform:rotate(308.57deg)"><span>ä¸“å±çº¢åŒ…188ï¼ˆé™28ä»½ï¼‰</span></div>
        </div>
        <div class="lottery-pointer"></div>
        <button class="lottery-btn" id="drawBtn" disabled>ç‚¹å‡»æŠ½å¥–</button>
    </div>
    
    <div class="footer-tip">ğŸ“Œ å‘¨ä¸€é‡ç½®æŠ½å¥–æœºä¼š | æŠ½ä¸­å¥–å“å½“æœˆæœ‰æ•ˆ | ä¸­å¥–åå•ç¾¤å†…å…¬ç¤º</div>
    
    <div class="confetti" id="confetti"></div>
    <div class="fireworks" id="fireworks"></div>
    <div class="modal" id="modal">
        <div class="modal-box">
            <div class="modal-title" id="modalTitle">æŠ½å¥–ç»“æœ</div>
            <div class="emoji" id="resultEmoji"></div>
            <div class="modal-content" id="modalContent"></div>
            <div class="rule-tip">æç¤ºï¼šå¥–å“é™å½“æœˆå…‘æ¢ï¼Œéœ€é€šè¿‡3-7å¤©äº’åŠ¨è®°å½•æ ¸æŸ¥</div>
            <button class="close-btn" id="closeBtn">ç¡®è®¤</button>
        </div>
    </div>
    
    <div class="audio-container">
        <audio id="rotateAudio" src="https://cdn.freesound.org/previews/512/512018_10226570-lq.mp3" preload="auto">
        <audio id="superWinAudio" src="https://cdn.freesound.org/previews/342/342777_6419044-lq.mp3" preload="auto">
        <audio id="normalWinAudio" src="https://cdn.freesound.org/previews/171/171925_3344444-lq.mp3" preload="auto">
        <audio id="loseAudio" src="https://cdn.freesound.org/previews/434/434290_8002009-lq.mp3" preload="auto">
        <audio id="fireworkAudio" src="https://cdn.freesound.org/previews/427/427490_8250102-lq.mp3" preload="auto">
        <audio id="confettiAudio" src="https://cdn.freesound.org/previews/442/442340_9373373-lq.mp3" preload="auto">
    </div>
    
    <script>
        // å·²æ¤å…¥ä½ çš„Googleè¡¨æ ¼IDï¼Œæ— éœ€ä¿®æ”¹
        const SHEET_ID = "16kXTKrllRtbfMrD60Grqd0f9ux_L-QqYI-QPfJ30zu0";
        async function loadSheetData() {
            try {
                const response = await fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`);
                const text = await response.text();
                const jsonStr = text.match(/google\.visualization\.Query\.setResponse\((.+)\)/)[1];
                const data = JSON.parse(jsonStr).table.rows.map(row => ({
                    è´¦å·: row.c[0]?.v || '',
                    å‰©ä½™æŠ½å¥–æ¬¡æ•°: row.c[1]?.v || 0,
                    å·²ä¸­å¥–æ¬¡æ•°: row.c[2]?.v || 0,
                    æœ€åæŠ½å¥–æ—¶é—´: row.c[3]?.v || ''
                }));
                return data;
            } catch (error) {
                console.error('åŠ è½½è¡¨æ ¼æ•°æ®å¤±è´¥:', error);
                showModal("åŠ è½½å¤±è´¥", "è¡¨æ ¼æƒé™æœªå¼€æ”¾æˆ–ç½‘ç»œæ³¢åŠ¨ï¼Œç¨åé‡è¯•ï½", "ğŸ˜¥");
                return [];
            }
        }
        async function updateSheetData(account, newTimes) {
            console.log(`è´¦å· ${account} å‰©ä½™æŠ½å¥–æ¬¡æ•°æ›´æ–°ä¸º ${newTimes}`);
        }
        
        const prizeAngle = {
            "å·®ä¸€ç‚¹ç‚¹": -25.71,
            "1888è¶…çº§ç¦åˆ©ï¼ˆé™3ä»½ï¼‰": -77.14,
            "888ä¸“å±ç¦åˆ©ï¼ˆé™5ä»½ï¼‰": -128.57,
            "è½¬è¿é‡‘Ã—1ï¼ˆé™5ä»½ï¼‰": -180,
            "ä¸“å±çº¢åŒ…388ï¼ˆé™8ä»½ï¼‰": -231.43,
            "ä¸“å±çº¢åŒ…288ï¼ˆé™18ä»½ï¼‰": -282.86,
            "ä¸“å±çº¢åŒ…188ï¼ˆé™28ä»½ï¼‰": -334.29
        };
        
        const wheel = document.getElementById('wheel');
        const drawBtn = document.getElementById('drawBtn');
        const accInput = document.getElementById('accInput');
        const submitBtn = document.getElementById('submitBtn');
        const remainText = document.getElementById('remainText');
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modalTitle');
        const modalContent = document.getElementById('modalContent');
        const resultEmoji = document.getElementById('resultEmoji');
        const closeBtn = document.getElementById('closeBtn');
        const confetti = document.getElementById('confetti');
        const fireworks = document.getElementById('fireworks');
        const rotateAudio = document.getElementById('rotateAudio');
        const superWinAudio = document.getElementById('superWinAudio');
        const normalWinAudio = document.getElementById('normalWinAudio');
        const loseAudio = document.getElementById('loseAudio');
        const fireworkAudio = document.getElementById('fireworkAudio');
        const confettiAudio = document.getElementById('confettiAudio');
        let isRotating = false;
        let currUser = null;
        let currentAngle = 0;
        
        submitBtn.addEventListener('click', async () => {
            const val = accInput.value.trim();
            if (!val) {
                showModal("è¾“å…¥ä¸ºç©º", "è¯·è¾“å…¥æœ‰æ•ˆçš„æŠ½å¥–è´¦å·ï½", "ğŸ˜…");
                return;
            }
            const sheetData = await loadSheetData();
            const user = sheetData.find(item => item.è´¦å· === val);
            if (user) {
                currUser = {
                    account: val,
                    draw_times: parseInt(user.å‰©ä½™æŠ½å¥–æ¬¡æ•°) || 0
                };
                remainText.textContent = `å‰©ä½™æŠ½å¥–æ¬¡æ•°ï¼š${currUser.draw_times}æ¬¡`;
                accInput.style.borderColor = '#e63946';
                drawBtn.style.display = 'block';
                drawBtn.disabled = currUser.draw_times <= 0;
                accInput.blur();
            } else {
                drawBtn.style.display = 'none';
                remainText.textContent = "è¯·è¾“å…¥æœ‰æ•ˆè´¦å·";
                accInput.style.borderColor = '#ff6b6b';
                showModal("è´¦å·æ— æ•ˆ", "å½“å‰è´¦å·æœªå¼€æ”¾æŠ½å¥–æƒé™ï½", "ğŸ˜…");
            }
        });
        
        drawBtn.addEventListener('click', () => {
            if (isRotating || !currUser) return;
            if (currUser.draw_times <= 0) {
                showModal("æ¬¡æ•°ç”¨å°½", "å½“å‰è´¦å·å·²æ— æŠ½å¥–æ¬¡æ•°ï¼Œå‘¨ä¸€é‡æ–°æŠ•æ”¾ï½", "ğŸ˜”");
                return;
            }
            wheel.style.transition = 'none';
            wheel.style.transform = `rotate(${currentAngle}deg)`;
            void wheel.offsetWidth;
            rotateAudio.currentTime = 0;
            rotateAudio.play().catch(err => console.log("éŸ³æ•ˆæ’­æ”¾éœ€å¼€å¯éŸ³é‡"));
            const prizes = Object.keys(prizeAngle);
            const randomPrize = prizes[Math.floor(Math.random() * prizes.length)];
            currentAngle += 360 * 25 + prizeAngle[randomPrize];
            const targetAngle = currentAngle;
            isRotating = true;
            drawBtn.disabled = true;
            wheel.style.transition = 'transform 23s cubic-bezier(0.2, 0.8, 0.3, 1)';
            wheel.style.transform = `rotate(${targetAngle}deg)`;
            
            setTimeout(() => {
                isRotating = false;
                const newTimes = currUser.draw_times - 1;
                currUser.draw_times = newTimes;
                updateSheetData(currUser.account, newTimes);
                remainText.textContent = `å‰©ä½™æŠ½å¥–æ¬¡æ•°ï¼š${newTimes}æ¬¡`;
                
                if (randomPrize === "å·®ä¸€ç‚¹ç‚¹") {
                    loseAudio.currentTime = 0;
                    loseAudio.play().catch(() => {}); 
showModal("å†æ¥å†å‰", "å·®ä¸€ç‚¹ç‚¹å°±ä¸­å¥–å•¦ï¼ç§¯åˆ†å¤šæ”’å¤šæŠ½ï¼Œä¸‹æ¬¡å¿…ä¸­ï½", "ğŸ™");
                } else {
                    startConfetti();
                    confettiAudio.currentTime = 0;
                    confettiAudio.play().catch(err => console.log("éŸ³æ•ˆæ’­æ”¾éœ€å¼€å¯éŸ³é‡"));
                    
                    if (randomPrize.includes("1888")) {
                        fireworkAudio.currentTime = 0;
                        fireworkAudio.play().catch(err => console.log("éŸ³æ•ˆæ’­æ”¾éœ€å¼€å¯éŸ³é‡"));
                        superWinAudio.currentTime = 0;
                        superWinAudio.play().catch(err => console.log("éŸ³æ•ˆæ’­æ”¾éœ€å¼€å¯éŸ³é‡"));
                        startFireworks();
                        showModal("æ­å–œä¸­å¤§å¥–", `æ­å–œæŠ½ä¸­ã€${randomPrize}ã€‘ï¼è”ç³»ç»ç†å…‘æ¢ï¼Œå½“æœˆæœ‰æ•ˆï½`, "ğŸ˜„");
                    } else {
                        normalWinAudio.currentTime = 0;
                        normalWinAudio.play().catch(err => console.log("éŸ³æ•ˆæ’­æ”¾éœ€å¼€å¯éŸ³é‡"));
                        showModal("æ­å–œä¸­å¥–", `æ­å–œæŠ½ä¸­ã€${randomPrize}ã€‘ï¼è”ç³»ç»ç†å…‘æ¢ï¼Œå½“æœˆæœ‰æ•ˆï½`, "ğŸ˜Š");
                    }
                }
                if (newTimes > 0) {
                    drawBtn.disabled = false;
                }
            }, 23000);
        });
        
        closeBtn.addEventListener('click', () => {
            modal.style.display = 'none';
            confetti.style.display = 'none';
            confetti.innerHTML = '';
            fireworks.style.display = 'none';
            fireworks.innerHTML = '';
        });
        
        function showModal(title, content, emoji) {
            modalTitle.textContent = title;
            resultEmoji.textContent = emoji;
            modalContent.textContent = content;
            modal.style.display = 'flex';
        }
        
        function startConfetti() {
            confetti.style.display = 'block';
            confetti.innerHTML = '';
            const colors = ['#e63946', '#ff6b6b', '#ff8a80', '#ffb3b3'];
            const modalBox = document.querySelector('.modal-box');
            const rect = modalBox.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            for (let i = 0; i < 4; i++) {
                setTimeout(() => {
                    for (let j = 0; j < 80; j++) {
                        const piece = document.createElement('div');
                        piece.className = 'confetti-piece';
                        piece.style.left = `${centerX}px`;
                        piece.style.top = `${centerY}px`;
                        piece.style.background = colors[Math.floor(Math.random() * colors.length)];
                        piece.style.setProperty('--x', `${Math.random() * 400 - 200}px`);
                        piece.style.setProperty('--y', `${Math.random() * 400 - 200}px`);
                        confetti.appendChild(piece);
                    }
                }, i * 500);
            }
            setTimeout(() => {
                confetti.style.display = 'none';
                confetti.innerHTML = '';
            }, 4000);
        }
        
        function startFireworks() {
            fireworks.style.display = 'block';
            fireworks.innerHTML = '';
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    const firework = document.createElement('div');
                    firework.className = 'firework';
                    const x = Math.random() * 100;
                    const y = Math.random() * 80;
                    firework.style.left = `${x}vw`;
                    firework.style.top = `${y}vh`;
                    const colors = ['#e63946', '#ff6b6b', '#4285f4', '#00ff00', '#ffff00', '#ff00ff'];
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    firework.style.background = color;
                    fireworks.appendChild(firework);
                    setTimeout(() => {
                        for (let j = 0; j < 20; j++) {
                            const piece = document.createElement('div');
                            piece.className = 'firework-piece';
                            piece.style.left = `${x}vw`;
                            piece.style.top = `${y}vh`;
                            piece.style.background = color;
                            piece.style.setProperty('--x', `${Math.random() * 300 - 150}px`);
                            piece.style.setProperty('--y', `${Math.random() * 300 - 150}px`);
                            fireworks.appendChild(piece);
                        }
                    }, 500);
                }, i * 300);
            }
            setTimeout(() => {
                fireworks.style.display = 'none';
                fireworks.innerHTML = '';
            }, 5000);
        }
    </script>
</body>
</html>
