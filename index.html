<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¸è¿å¤§è½¬ç›˜ - ç§¯åˆ†ç™½å«–æ— é—¨æ§›</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        /* èƒŒæ™¯å±‚æ ·å¼ */
        #dynamic-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -1;
            background-image: url('baipiao_2.jpg');
        body {
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            font-family: "Microsoft Yahei", "PingFang SC", sans-serif;
            color: #333;
        }

        /* æ¢è‚¤æŒ‰é’® */
        .bg-switch-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid #e63946;
            color: #e63946;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            backdrop-filter: blur(5px);
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .bg-switch-btn:hover {
            background: #e63946;
            color: #fff;
        }

        /* ä¸»ä½“å¸ƒå±€ç»“æ„ */
        .main-wrapper {
            display: flex;
            width: 95%;
            max-width: 1200px;
            height: 85vh;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        /* å·¦ä¾§è§„åˆ™åŒºåŸŸ */
        .side-rules {
            flex: 0 0 300px;
            background: rgba(230, 57, 70, 0.05);
            padding: 40px 30px;
            border-right: 1px solid rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
        }
        .side-rules h2 {
            font-size: 22px;
            color: #e63946;
            margin-bottom: 20px;
            border-bottom: 2px solid #e63946;
            padding-bottom: 10px;
        }
        .rule-list {
            list-style: none;
            line-height: 1.8;
            font-size: 14px;
            color: #555;
        }
        .rule-list li {
            margin-bottom: 15px;
            position: relative;
            padding-left: 20px;
        }
        .rule-list li::before {
            content: "âœ¦";
            position: absolute;
            left: 0;
            color: #e63946;
        }

        /* å³ä¾§æ ¸å¿ƒæŠ½å¥–åŒºåŸŸ */
        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
        }

        .activity-title {
            font-size: 28px;
            color: #e63946;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .activity-subtitle {
            font-size: 16px;
            color: #457b9d;
            margin-bottom: 25px;
        }

        /* è¾“å…¥ç»„ */
        .input-wrapper {
            text-align: center;
            margin-bottom: 20px;
            z-index: 20;
        }
        .remain-times {
            font-size: 18px;
            margin-bottom: 10px;
            font-weight: bold;
            color: #e63946;
        }
        .account-group {
            display: flex;
            gap: 10px;
        }
        .account-input {
            padding: 10px 15px;
            width: 200px;
            border: 2px solid #ddd;
            border-radius: 8px;
            outline: none;
        }
        .account-input:focus { border-color: #e63946; }
        .submit-btn {
            padding: 10px 20px;
            background: #e63946;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        /* è½¬ç›˜æ ·å¼ä¿æŒ */
        .lottery-container {
            position: relative;
            width: 380px;
            height: 380px;
            margin-top: 10px;
        }
        .lottery-wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            border: 8px solid #e63946;
            background: #fff;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        .wheel-item {
            position: absolute;
            width: 50%;
            height: 50%;
            left: 50%;
            top: 0;
            transform-origin: left bottom;
            clip-path: polygon(0 0, 100% 0, 100% 100%);
            display: flex;
            justify-content: center;
            padding-top: 40px;
            color: #fff;
            font-size: 14px;
            font-weight: bold;
        }
        .wheel-item:nth-child(1){background: #e63946;}
        .wheel-item:nth-child(2){background: #2a9d8f;}
        .wheel-item:nth-child(3){background: #f4a261;}
        .wheel-item:nth-child(4){background: #264653;}
        .wheel-item:nth-child(5){background: #e9c46a;}
        .wheel-item:nth-child(6){background: #f1faee; color: #333;}
        .wheel-item:nth-child(7){background: #8d99ae;}

        .lottery-pointer {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 50px;
            background: #e63946;
            clip-path: polygon(50% 0, 0 100%, 100% 100%);
            z-index: 10;
        }
        .lottery-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #e63946;
            border: 4px solid #fff;
            color: #fff;
            font-weight: bold;
            cursor: pointer;
            z-index: 15;
            display: none;
        }

        /* æ¨¡æ€æ¡†ç­‰å…¶ä»–æ ·å¼ */
        .modal { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.6); z-index: 2000; display: none; justify-content: center; align-items: center; }
        .modal-box { width: 320px; padding: 30px; background: #fff; border-radius: 15px; text-align: center; }
        .close-btn { margin-top: 20px; padding: 10px 30px; background: #e63946; color: white; border: none; border-radius: 5px; cursor: pointer; }
        
        .footer-tip { margin-top: 20px; font-size: 12px; color: #888; }
        .confetti, .fireworks { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 2100; display: none; }
    </style>
</head>
<body>

    <!-- èƒŒæ™¯åˆ‡æ¢å±‚ -->
    <div id="dynamic-bg"></div>

    <!-- æ¢è‚¤æŒ‰é’® -->
    <button class="bg-switch-btn" id="bgSwitchBtn">âœ¨ åˆ‡æ¢èƒŒæ™¯</button>

    <div class="main-wrapper">
        <!-- å·¦ä¾§è§„åˆ™æ  -->
        <div class="side-rules">
            <h2>æ´»åŠ¨è¯´æ˜</h2>
            <ul class="rule-list">
                <li>æœ¬æ´»åŠ¨ä»…é™æ³¨å†Œä¼šå‘˜å‚ä¸ï¼Œè¾“å…¥è´¦å·å³å¯æŸ¥è¯¢æŠ½å¥–èµ„æ ¼ã€‚</li>
                <li>æŠ½å¥–æœºä¼šæ¯å‘¨ä¸€ 00:00 é‡ç½®ï¼Œè¯·åŠæ—¶ä½¿ç”¨ã€‚</li>
                <li><strong>1888/888ç¦åˆ©</strong>ï¼šæŠ½ä¸­åè¯·æˆªå±å¹¶è”ç³»ä¸“å±ç»ç†é¢†å–ã€‚</li>
                <li><strong>è½¬è¿é‡‘</strong>ï¼šå¯ç”¨äºç§¯åˆ†å•†åŸå…‘æ¢ä»»æ„å®ç‰©å¥½ç¤¼ã€‚</li>
                <li>æ‰€æœ‰å¥–å“éœ€ç»è¿‡3-7å¤©è´¦å·æ´»è·ƒåº¦å®¡æ ¸ã€‚</li>
                <li>è‹¥å‘ç°ä½œå¼Šè¡Œä¸ºï¼Œå°†å–æ¶ˆè¯¥è´¦å·ä¸­å¥–èµ„æ ¼ã€‚</li>
            </ul>
            <div class="footer-tip">å¦‚æœ‰ç–‘é—®ï¼Œè¯·å’¨è¯¢24å°æ—¶åœ¨çº¿å®¢æœ</div>
        </div>

        <!-- å³ä¾§æ ¸å¿ƒæŠ½å¥– -->
        <div class="content-area">
            <div class="activity-title">ç§¯åˆ†ç™½å«–æ— é—¨æ§›</div>
            <div class="activity-subtitle">å¹¸ è¿ å¤§ è½¬ ç›˜ Â· 100% ä¸­ å¥–</div>
            
            <div class="input-wrapper">
                <div class="remain-times" id="remainText">è¯·è¾“å…¥è´¦å·æŸ¥è¯¢æ¬¡æ•°</div>
                <div class="account-group">
                    <input type="text" class="account-input" id="accInput" placeholder="è¾“å…¥æŠ½å¥–è´¦å·">
                    <button class="submit-btn" id="submitBtn">æŸ¥è¯¢</button>
                </div>
            </div>
            
            <div class="lottery-container">
                <div class="lottery-wheel" id="wheel">
                    <div class="wheel-item" style="transform:rotate(0deg)"><span>å·®ä¸€ç‚¹ç‚¹</span></div>
                    <div class="wheel-item" style="transform:rotate(51.43deg)"><span>1888è¶…çº§ç¦åˆ©</span></div>
                    <div class="wheel-item" style="transform:rotate(102.86deg)"><span>888ä¸“å±ç¦åˆ©</span></div>
                    <div class="wheel-item" style="transform:rotate(154.29deg)"><span>è½¬è¿é‡‘Ã—1</span></div>
                    <div class="wheel-item" style="transform:rotate(205.71deg)"><span>ä¸“å±çº¢åŒ…388</span></div>
                    <div class="wheel-item" style="transform:rotate(257.14deg)"><span>ä¸“å±çº¢åŒ…288</span></div>
                    <div class="wheel-item" style="transform:rotate(308.57deg)"><span>ä¸“å±çº¢åŒ…188</span></div>
                </div>
                <div class="lottery-pointer"></div>
                <button class="lottery-btn" id="drawBtn">å¼€å§‹</button>
            </div>
        </div>
    </div>

    <!-- æ¨¡æ€æ¡†ä¸ç‰¹æ•ˆ -->
    <div class="modal" id="modal">
        <div class="modal-box">
            <div id="modalTitle" style="font-weight:bold; color:#e63946; font-size:20px;">æŠ½å¥–ç»“æœ</div>
            <div id="resultEmoji" style="font-size: 40px; margin: 15px 0;"></div>
            <div id="modalContent"></div>
            <button class="close-btn" id="closeBtn">æˆ‘çŸ¥é“äº†</button>
        </div>
    </div>

    <div class="confetti" id="confetti"></div>
    <div class="fireworks" id="fireworks"></div>

    <!-- éŸ³æ•ˆ -->
    <div style="display:none">
        <audio id="rotateAudio" src="https://cdn.freesound.org/previews/512/512018_10226570-lq.mp3"></audio>
        <audio id="normalWinAudio" src="https://cdn.freesound.org/previews/171/171925_3344444-lq.mp3"></audio>
    </div>

    <script>
        // --- èƒŒæ™¯åˆ‡æ¢åŠŸèƒ½ ---
        const bgImages = ['baipiao_1.jpg', 'baipiao_2.jpg', 'high_1.jpg', 'high_2.jpg', 'middle_1.jpg', 'middle_2.jpg'];
        let currentBgIndex = 0;
        const bgLayer = document.getElementById('dynamic-bg');
        const bgSwitchBtn = document.getElementById('bgSwitchBtn');

        function setBackground(index) {
            bgLayer.style.opacity = 0; // å…ˆæ·¡å‡º
            setTimeout(() => {
                // å¦‚æœå®é™…æ²¡æœ‰è¿™äº›å›¾ç‰‡æ–‡ä»¶ï¼ŒèƒŒæ™¯å°†æ˜¾ç¤ºé»˜è®¤é¢œè‰²
                bgLayer.style.backgroundImage = `url('${bgImages[index]}')`;
                bgLayer.style.opacity = 1; // å†æ·¡å…¥
            }, 300);
        }

        // åˆå§‹åŒ–èƒŒæ™¯
        setBackground(0);

        bgSwitchBtn.addEventListener('click', () => {
            currentBgIndex = (currentBgIndex + 1) % bgImages.length;
            setBackground(currentBgIndex);
        });

        // --- æŠ½å¥–é€»è¾‘ (ä¿æŒå¹¶ä¼˜åŒ–) ---
        const SHEET_ID = "16kXTKrllRtbfMrD60Grqd0f9ux_L-QqYI-QPfJ30zu0";
        const prizeAngle = {
            "å·®ä¸€ç‚¹ç‚¹": -25.71,
            "1888è¶…çº§ç¦åˆ©": -77.14,
            "888ä¸“å±ç¦åˆ©": -128.57,
            "è½¬è¿é‡‘Ã—1": -180,
            "ä¸“å±çº¢åŒ…388": -231.43,
            "ä¸“å±çº¢åŒ…288": -282.86,
            "ä¸“å±çº¢åŒ…188": -334.29
        };

        let currUser = null;
        let isRotating = false;
        let currentAngle = 0;

        async function loadSheetData() {
            try {
                const response = await fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`);
                const text = await response.text();
                const jsonStr = text.match(/google\.visualization\.Query\.setResponse\((.+)\)/)[1];
                return JSON.parse(jsonStr).table.rows.map(row => ({
                    è´¦å·: row.c[0]?.v || '',
                    æ¬¡æ•°: row.c[1]?.v || 0
                }));
            } catch (e) { return []; }
        }

        document.getElementById('submitBtn').addEventListener('click', async () => {
            const val = document.getElementById('accInput').value.trim();
            if(!val) return;
            const data = await loadSheetData();
            const user = data.find(i => i.è´¦å· === val);
            if(user) {
                currUser = { account: val, times: parseInt(user.æ¬¡æ•°) };
                document.getElementById('remainText').textContent = `å‰©ä½™æœºä¼šï¼š${currUser.times}æ¬¡`;
                document.getElementById('drawBtn').style.display = 'block';
                document.getElementById('drawBtn').disabled = currUser.times <= 0;
            } else {
                alert("æœªæ‰¾åˆ°è´¦å·æˆ–æ— æƒé™");
            }
        });

        document.getElementById('drawBtn').addEventListener('click', () => {
            if (isRotating || currUser.times <= 0) return;
            
            isRotating = true;
            document.getElementById('drawBtn').disabled = true;
            document.getElementById('rotateAudio').play().catch(()=>{});

            const prizes = Object.keys(prizeAngle);
            const result = prizes[Math.floor(Math.random() * prizes.length)];
            currentAngle += 360 * 10 + prizeAngle[result];
            
            const wheel = document.getElementById('wheel');
            wheel.style.transition = 'transform 8s cubic-bezier(0.2, 0, 0.2, 1)';
            wheel.style.transform = `rotate(${currentAngle}deg)`;

            setTimeout(() => {
                isRotating = false;
                currUser.times--;
                document.getElementById('remainText').textContent = `å‰©ä½™æœºä¼šï¼š${currUser.times}æ¬¡`;
                
                showModal(result);
                if(currUser.times > 0) document.getElementById('drawBtn').disabled = false;
            }, 8500);
        });

        function showModal(prize) {
            const modal = document.getElementById('modal');
            const content = document.getElementById('modalContent');
            const emoji = document.getElementById('resultEmoji');
            
            if(prize === "å·®ä¸€ç‚¹ç‚¹") {
                emoji.textContent = "ğŸ™";
                content.textContent = "å¥½å¯æƒœï¼Œå·®ä¸€ç‚¹å°±ä¸­å¥–äº†ï¼ä¸‹æ¬¡è¿æ°”ä¸€å®šæ›´å¥½~";
            } else {
                emoji.textContent = "ğŸ‰";
                content.textContent = `æ­å–œè·å¾—ã€${prize}ã€‘ï¼è¯·åŠæ—¶è”ç³»ç»ç†å…‘æ¢ã€‚`;
                document.getElementById('normalWinAudio').play().catch(()=>{});
            }
            modal.style.display = 'flex';
        }

        document.getElementById('closeBtn').addEventListener('click', () => {
            document.getElementById('modal').style.display = 'none';
        });
    </script>
</body>
</html>
